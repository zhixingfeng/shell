#!/bin/bash
if [ $# -ne 3 ] ; then
        echo "minimap2_nanopore_dir ref inputdir outputdir"
        exit 0
fi

mkdir -p $3

#ls $2 | egrep '*.(fa|fq|fastq|fasta|fastq.gz|fasta.gz)$' | awk -v ref=$1 -v indir=$2 -v outdir=$3 -v hpcopt="submitjob 2 -c 1 -m 4 -P acc_IcahnInstitute -q alloc" '{cmd=hpcopt" minimap2 -ax map-ont "ref" ./"indir"/"$0" > ./"outdir"/"$0".sam"; print cmd; system(cmd)}'

ls $2 | egrep '*.(fa|fq|fastq|fasta|fastq.gz|fasta.gz)$' | awk -v ref=$1 -v indir=$2 -v outdir=$3 '{cmd="minimap2 -ax map-ont "ref" ./"indir"/"$0" > ./"outdir"/"$0".sam"; print cmd; system(cmd)}'

#ls $2 | egrep '*.(fa|fq|fastq|fasta|fastq.gz|fasta.gz)$' | awk -v ref=$1 -v indir=$2 -v outdir=$3 -v hpcopt="submitjob 2 -c 1 -m 4 -P acc_IcahnInstitute -q alloc" '{cmd=hpcopt" \"minimap2 -ax map-ont "ref" ./"indir"/"$0" > ./"outdir"/"$0".sam\""; print cmd; system(cmd)}'


#ls ./$1/*.fastq | awk -v outdir=$2 -v hpcopt="submitjob 1 -c 1 -m 2 -P acc_IcahnInstitute -q alloc" 'function basename(file) {
#    sub(".*/", "", file)
#    return file
#  }{cmd=hpcopt" filter_nanopore "$1" "outdir"/"basename($1); print cmd; system(cmd)}'




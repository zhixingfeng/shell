#!/bin/bash
if [ $# -ne 5 ] ; then
        echo "cmpgenome_dir indir reffile outdir nthread logdir"
        exit 0
fi

mkdir -p $3

indir=$1
reffile=$2
outdir=$3
nthread=$4
logdir=$5

for infile in $(ls $indir | egrep ".fna$|.fasta$|.fa$"); do
	outprefix=$outdir/${infile%.*}
	jobname=${infile%.*}
	submitjob -w 1 -c $nthread -m 4 -o $logdir cmpgenome $indir/$infile $reffile $outprefix
done


#ls $1 | egrep ".fna$|.fasta$|.fa$" | awk -v indir=$1 -v reffile=$2 -v outdir=$3 '{cmd="cmpgenome "indir"/"$0" "reffile" "outdir;gsub(".fasta","",$0);cmd=cmd"/"$0;print cmd; system(cmd)}'

#ls $1 | egrep ".fna$|.fasta$|.fa$" | awk -v indir=$1 -v reffile=$2 -v outdir=$3 -v hpcopt="submitjob 0.5 -c 1 -m 4 -P acc_LymeMIND -q premium" '{cmd=hpcopt" cmpgenome "indir"/"$0" "reffile" "outdir;gsub(".fasta","",$0);cmd=cmd"/"$0;print cmd; system(cmd)}'

